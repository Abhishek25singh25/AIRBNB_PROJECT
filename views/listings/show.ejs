<% layout("layouts/boilerplate") %>

<h2><%= listing.title %></h2>

<img src="<%= listing.image.url %>" class="img-fluid rounded mb-3">

<p><%= listing.description %></p>

<h5>â‚¹ <%= listing.price %> / night</h5>

<p><%= listing.location %>, <%= listing.country %></p>

<p>Hosted by <%= listing.owner.username %></p>

<% if(currentUser && listing.owner._id.equals(currentUser._id)) { %>
  <a href="/listings/<%= listing._id %>/edit" class="btn btn-danger me-2">Edit</a>

  <form action="/listings/<%= listing._id %>?_method=DELETE"
        method="POST"
        class="d-inline">
    <button class="btn btn-danger">Delete</button>
  </form>
<% } %>

<hr>

<h4>Reviews</h4>

<% listing.reviews.forEach(review => { %>
  <div class="border p-2 mb-2 rounded">
    <strong><%= review.author.username %></strong>
    <p><%= review.comment %></p>

    <% if(currentUser && review.author._id.equals(currentUser._id)) { %>
      <form action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE"
            method="POST">
        <button class="btn btn-sm btn-danger">Delete</button>
      </form>
    <% } %>
  </div>
<% }) %>